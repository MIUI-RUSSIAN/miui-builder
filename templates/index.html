<!DOCTYPE html>
<html>
    <head>
      <title>MIUI Builder</title>
      <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
      <link href="static/style.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <h1>MIUI Builder</h1>
        <table class='filetable filelist'>
        <tr>
          <th>status</th>
          <th>repo</th>
          <th>path</th>
          <th>exist</th>
          <th>dirty?</th>
          <th>last try sync time</th>
          <th>sync<br>ok?</th>
          <th>sync</th>
          <th>last system.img<br>build time</th>
          <th>build<br>ok?</th>
          <th>build</th>
          <th>clean</th>
          <th>last successful<br>clean build</th>
          <th>clean<br>build</th>
          <th>branch</th>
          <th>diff</th>
          <th>memo</th>
        </tr>
        {% for project in projects %}
        <tr>
          <td>Idle</td>
          <td>{{project['repo']}}</td>
          <td>{{project['path']}}</td>
          <td>{{project['exist']}}</td>
          <td>{{project['dirty_html']}}</td>
          <td>{{project['sync']}}</td>
          <td>{% set lss = project['last_sync_status'] %}<a href="log/sync?path={{project['path']}}&n={{nonce}}"><img src='static/icons/{% if lss == 'running' %}LoaderIcon.gif{% elif lss == 'ok' %}blueberry/check.png{% elif lss == 'n/a' %}blueberry/help.png{% else %}blueberry/attention.png{% end %}'></a></td>
          <td><a href="sync?path={{project['path']}}&n={{nonce}}"><img src='static/icons/blueberry/refresh.png'></a></td>
          <td>{{project['system']}}</td>
          <td>{% set lbs = project['last_build_status'] %}<a href="log/build?path={{project['path']}}&n={{nonce}}"><img src='static/icons/{% if lbs == 'running' %}LoaderIcon.gif{% elif lbs == 'ok' %}blueberry/check.png{% elif lbs == 'n/a' %}blueberry/help.png{% else %}blueberry/attention.png{% end %}'></a></td>
          <td><a href="build?path={{project['path']}}&n={{nonce}}"><img src='static/icons/blueberry/play.png'></a></td>
          <td><a href="clean?path={{project['path']}}&n={{nonce}}"><img src='static/icons/blueberry/sound_music-on.png'></a></td>
          <td>{{project['last_cleanbuildsuccess_time']}}</td>
          <td><a href="cleanbuild?path={{project['path']}}&n={{nonce}}"><img src='static/icons/blueberry/forward.png'></a></td>
          <td><a href="log/repo_branch?path={{project['path']}}&n={{nonce}}">branch</td>
          <td><a href="log/repo_diff?path={{project['path']}}&n={{nonce}}">diff</td>
          <td>{{project['memo']}}</td>
        </tr>
        {% end %}
        </table>
        <p>Powered by Tornado Framework and Python</p>
        <p>TODO: 1. repo branch and repo diff crontab, 2. running state by running screen, 3. pending waiting queue, 4. auto refresh, 5. task total running time</p>
        <h1>Action history:</h1>
        <ol>{% for log in actions %}<li>{{log}}</li>{% end %}</ol>
    </body>
</html>
